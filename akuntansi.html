<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUSADAD.COM V9 - Final Layout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Roboto+Condensed:wght@400;700&display=swap');

        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        
        /* HEADER APP STYLE */
        .header-app { background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 15px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-link.active { background-color: #1e3c72 !important; color: white !important; }
        .nav-link { color: #1e3c72; font-weight: bold; }
        
        /* TABLE STYLES */
        .table-masuk { background-color: #d1e7dd; } 
        .table-modal { background-color: #cfe2ff; } 
        .table-keluar { background-color: #f8d7da; } 

        /* --- NOTA DESIGN (CORE) --- */
        #areaNota {
            background: white;
            font-family: 'Roboto Condensed', sans-serif; /* Font Nota Ramping & Tegas */
            color: #000;
        }

        /* 1. Header Nota Cantik */
        .nota-brand {
            font-family: 'Oswald', sans-serif; /* Font Judul Tebal */
            font-size: 2.5rem;
            color: #1a2a6c; /* Biru Gelap Elegan */
            letter-spacing: 2px;
            margin-bottom: 0;
            line-height: 1.1;
            text-transform: uppercase;
        }
        .nota-sub {
            font-family: 'Arial', sans-serif;
            font-weight: 900;
            color: #b91d1d; /* Merah Bata */
            font-size: 0.9rem;
            letter-spacing: 1px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .nota-address {
            font-size: 0.8rem;
            color: #333;
            border-top: 2px solid #1a2a6c;
            border-bottom: 1px solid #1a2a6c;
            padding: 5px 0;
            margin-bottom: 15px;
        }

        /* 2. Tabel Nota */
        .nota-table thead {
            background-color: #1a2a6c !important;
            color: white !important;
            -webkit-print-color-adjust: exact;
        }
        .nota-table th { padding: 8px; font-weight: normal; letter-spacing: 1px; }
        .nota-table td { padding: 5px 8px; border-bottom: 1px solid #ddd; }
        .editable-name:hover { background-color: #fff9c4; cursor: text; }

        /* 3. Footer Boxes */
        .box-payment {
            border: 1px solid #000;
            padding: 5px;
            font-size: 0.7rem;
            height: 100%;
        }
        .box-warning {
            border: 2px solid red;
            background-color: #fff5f5;
            color: red;
            font-weight: bold;
            padding: 5px;
            font-size: 0.65rem;
            text-align: center;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-print-color-adjust: exact;
        }
        .box-sign {
            text-align: center;
            font-size: 0.8rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        /* PRINT SETTINGS */
        @media print {
            body * { visibility: hidden; }
            .print-nota #areaNota, .print-nota #areaNota * { visibility: visible; }
            .print-nota #areaNota { position: absolute; left: 0; top: 0; width: 100%; border: none; box-shadow: none; padding: 0; margin: 0; }
            .print-nota .no-print { display: none !important; }
            
            .print-belanja #areaBelanja, .print-belanja #areaBelanja * { visibility: visible; }
            .print-belanja #areaBelanja { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body>

<div class="header-app mb-3 no-print">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <h4 class="mb-0 fw-bold"><i class="fas fa-print"></i> MUSADAD SYSTEM V9</h4>
        </div>
        <div>
            <button onclick="downloadDB()" class="btn btn-warning btn-sm text-dark fw-bold shadow">ðŸ’¾ Backup</button>
            <input type="file" id="fileInput" hidden onchange="uploadDB(this)">
            <button onclick="document.getElementById('fileInput').click()" class="btn btn-light btn-sm fw-bold shadow">ðŸ“‚ Restore</button>
        </div>
    </div>
</div>

<div class="container mb-5">
    <ul class="nav nav-pills nav-fill mb-3 bg-white p-2 rounded shadow-sm no-print">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabKasir">ðŸ›’ Kasir</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabGudang">ðŸ“¦ Gudang</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabLaporan">ðŸ“Š Laporan</button></li>
    </ul>

    <div class="tab-content">

        <div class="tab-pane fade show active" id="tabKasir">
            <div class="row">
                <div class="col-md-4 no-print">
                    <div class="card p-3 shadow-sm mb-3 border-0">
                        <h6 class="fw-bold text-primary">Input Transaksi</h6>
                        <input type="text" id="custNama" class="form-control form-control-sm mb-2" placeholder="Nama Pelanggan">
                        <input type="text" id="custTelp" class="form-control form-control-sm mb-2" placeholder="No HP/WA">
                        <hr class="my-2">
                        <label class="small text-muted">Cari Barang:</label>
                        <input list="listBarang" id="inputBarang" class="form-control mb-2" placeholder="Ketik nama..." onchange="updateHarga()" autocomplete="off">
                        <datalist id="listBarang"></datalist>
                        <div class="row g-2">
                            <div class="col-8"><input type="number" id="hargaBarang" class="form-control form-control-sm" placeholder="Harga" readonly></div>
                            <div class="col-4"><input type="number" id="qtyBarang" class="form-control form-control-sm" value="1"></div>
                        </div>
                        <button onclick="tambahItem()" class="btn btn-primary btn-sm w-100 mt-3 fw-bold">âž• MASUKKAN</button>
                    </div>

                    <div class="card p-3 shadow-sm border-0">
                        <h6 class="fw-bold text-dark">Riwayat Nota</h6>
                        <input type="text" id="cariNota" class="form-control form-control-sm mb-2" placeholder="Cari..." onkeyup="renderRiwayatNota()">
                        <div style="max-height: 200px; overflow-y: auto;">
                            <table class="table table-sm table-hover small font-monospace">
                                <thead class="table-light"><tr><th>No</th><th>Nama</th><th>#</th></tr></thead>
                                <tbody id="tabelRiwayatNota"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-md-8">
                    <div class="card p-4 shadow-lg" id="areaNota">
                        
                        <div class="text-center">
                            <h1 class="nota-brand">MUSADAD.COM</h1>
                            <div class="nota-sub">PERCETAKAN DAN SERVICE KOMPUTER</div>
                            <div class="nota-address">
                                Jl. Rp.Garendong - Cisema Petir, Kab.Serang BANTEN<br>
                                <strong>Tlp/WA: 0838-1235-2663</strong> &nbsp;|&nbsp; Email: musadad08@gmail.com
                            </div>
                        </div>
                        
                        <div class="row small mb-2">
                            <div class="col-6">
                                NO: <span id="notaNo" class="fw-bold">AUTO</span><br>
                                TGL: <span id="notaTgl">-</span>
                            </div>
                            <div class="col-6 text-end">
                                Kpd Yth: <span id="notaYth" class="fw-bold fs-6 text-uppercase">-</span><br>
                                <span id="notaHp">-</span>
                            </div>
                        </div>

                        <table class="table table-sm nota-table align-middle mb-2">
                            <thead>
                                <tr>
                                    <th width="5%" class="text-center">No</th>
                                    <th>Nama Barang</th> <th class="text-center" width="10%">Qty</th>
                                    <th class="text-end" width="20%">Harga</th>
                                    <th class="text-end" width="22%">Total</th>
                                    <th class="no-print" width="5%"></th>
                                </tr>
                            </thead>
                            <tbody id="notaIsi"></tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" class="text-end fw-bold">TOTAL TAGIHAN :</td>
                                    <td class="text-end fw-bold fs-6" id="notaTotal">0</td>
                                    <td></td>
                                </tr>
                                <tr class="no-print">
                                    <td colspan="4" class="text-end align-middle">Bayar / DP:</td>
                                    <td><input type="number" id="inputDP" class="form-control form-control-sm text-end p-0" value="0" onkeyup="hitungSisa()"></td>
                                    <td></td>
                                </tr>
                                <tr class="print-only-row">
                                    <td colspan="4" class="text-end">Tunai / DP :</td>
                                    <td class="text-end" id="printDP">0</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end fw-bold text-danger">SISA / KEMBALI :</td>
                                    <td class="text-end fw-bold text-danger" id="notaSisa">0</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>

                        <div class="row mt-3 gx-2">
						
                            <div class="col-4">
                                <div class="payment">
                                    <strong>PEMBAYARAN BISA MELALUI:</strong><br>
                                    Transfer Bank:<br>
                                    <span class="fw-bold">BCA: 5410927839</span><br>
                                    (ROHMATULLOH AL MUSADAD)<br>
                                    <span class="fw-bold">DANA/GOPAY: 083812352663</span>
                                </div>
                            </div>
                            
                            <div class="col-4">
                                <div class="box-sign">
                                    <div class="mb-4"></div>
                                    <div></div>
                                </div>
                            </div>
							<div class="col-4">
                                <div class="box-sign">
                                    <div class="mb-4">Diterima,</div>
                                    <div>( ........................................ )</div>
                                </div>
                            </div>
							<div class="col-4">
                                <div class="box-warning">
                                    PERHATIAN !!!<br>
                                    Barang-barang yang sudah dibeli<br>tidak bisa ditukar / dikembalikan
                                </div>
                            </div>
                            </div>
                        </div>

                        
						<div class="text-center mt-3 no-print">
						 <small class="text-muted fst-italic">Terima kasih atas kepercayaan Anda.</small>
                        </div>

                        <div class="no-print mt-3 d-grid gap-2">
                            <button onclick="simpanDanCetak()" class="btn btn-primary fw-bold"><i class="fas fa-print"></i> CETAK NOTA</button>
                            <button onclick="resetNota()" class="btn btn-outline-danger btn-sm">Batal</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tabGudang">
            <div class="row">
                <div class="col-md-4 no-print mb-3">
                    <div class="card p-3 shadow-sm bg-light">
                        <h6 class="fw-bold">Tambah Produk</h6>
                        <input type="text" id="prodNama" class="form-control mb-2" placeholder="Nama Barang">
                        <input type="number" id="prodHarga" class="form-control mb-2" placeholder="Harga Jual">
                        <div class="row g-2 mb-2">
                            <div class="col-6"><input type="number" id="prodStok" class="form-control" placeholder="Stok"></div>
                            <div class="col-6"><input type="number" id="prodMin" class="form-control" placeholder="Min"></div>
                        </div>
                        <button onclick="tambahProduk()" class="btn btn-primary w-100">Simpan</button>
                    </div>
                    <button onclick="cetakBelanja()" class="btn btn-warning w-100 mt-3 fw-bold">Print Daftar Belanja</button>
                </div>

                <div class="col-md-8">
                    <div class="card p-3 shadow-sm">
                        <input type="text" id="cariGudang" class="form-control mb-3" placeholder="Cari stok..." onkeyup="renderGudang()">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle small">
                                <thead class="table-dark"><tr><th>Barang</th><th>Stok</th><th>Isi</th><th>Hapus</th></tr></thead>
                                <tbody id="tabelGudang"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div id="areaBelanja" class="d-none">
                    <h3 class="text-center">DAFTAR BELANJA MUSADAD.COM</h3>
                    <table class="table table-bordered mt-3">
                        <thead><tr><th>No</th><th>Nama</th><th>Sisa</th><th>Cek</th></tr></thead>
                        <tbody id="isiBelanja"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tabLaporan">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <div class="card p-3 border-success mb-2 bg-success bg-opacity-10">
                        <h6 class="fw-bold text-success">Input Pemasukan (Modal)</h6>
                        <input type="date" id="inTgl" class="form-control mb-1">
                        <input type="text" id="inKet" class="form-control mb-1" placeholder="Ket (Cth: Modal)">
                        <input type="number" id="inJml" class="form-control mb-2" placeholder="Rp">
                        <button onclick="simpanPemasukanLain()" class="btn btn-success w-100 btn-sm">Simpan</button>
                    </div>
                    <div class="card p-3 border-danger bg-danger bg-opacity-10">
                        <h6 class="fw-bold text-danger">Input Pengeluaran</h6>
                        <input type="date" id="expTgl" class="form-control mb-1">
                        <input type="text" id="expKet" class="form-control mb-1" placeholder="Ket (Cth: Listrik)">
                        <input type="number" id="expJml" class="form-control mb-2" placeholder="Rp">
                        <button onclick="simpanPengeluaran()" class="btn btn-danger w-100 btn-sm">Simpan</button>
                    </div>
                </div>

                <div class="col-md-8">
                    <div class="card p-3 shadow-sm">
                        <div class="d-flex justify-content-between mb-2">
                            <h5 class="fw-bold">Laporan Keuangan</h5>
                            <button onclick="resetData()" class="btn btn-outline-secondary btn-sm">Reset</button>
                        </div>
                        <div class="row text-center mb-2 g-1 small">
                            <div class="col-4"><div class="p-1 bg-success text-white">Masuk<br><span id="totMasuk">0</span></div></div>
                            <div class="col-4"><div class="p-1 bg-danger text-white">Keluar<br><span id="totKeluar">0</span></div></div>
                            <div class="col-4"><div class="p-1 bg-primary text-white">Saldo<br><span id="totProfit">0</span></div></div>
                        </div>
                        <div style="height: 400px; overflow-y: auto;">
                            <table class="table table-bordered table-sm small">
                                <thead class="table-secondary sticky-top"><tr><th>Tgl</th><th>Ket</th><th class="text-end">Masuk</th><th class="text-end">Keluar</th></tr></thead>
                                <tbody id="tabelLaporan"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let db = {
        produk: JSON.parse(localStorage.getItem('musadad_prod')) || [],
        nota: JSON.parse(localStorage.getItem('musadad_nota')) || [],
        pengeluaran: JSON.parse(localStorage.getItem('musadad_exp')) || [],
        pemasukanLain: JSON.parse(localStorage.getItem('musadad_income')) || []
    };
    let keranjang = [];

    window.onload = function() {
        let todayStr = new Date().toISOString().split('T')[0];
        document.getElementById('expTgl').value = todayStr;
        document.getElementById('inTgl').value = todayStr;
        initView();
    };

    function simpanKeBrowser() {
        localStorage.setItem('musadad_prod', JSON.stringify(db.produk));
        localStorage.setItem('musadad_nota', JSON.stringify(db.nota));
        localStorage.setItem('musadad_exp', JSON.stringify(db.pengeluaran));
        localStorage.setItem('musadad_income', JSON.stringify(db.pemasukanLain));
    }

    function initView() {
        renderStokOption(); renderGudang(); renderRiwayatNota(); renderLaporan();
        let today = new Date();
        document.getElementById('notaNo').innerText = `INV/${today.getDate()}${today.getMonth()+1}/${db.nota.length + 1}`;
        document.getElementById('notaTgl').innerText = today.toLocaleDateString('id-ID');
    }

    function renderStokOption() {
        let dl = document.getElementById('listBarang'); dl.innerHTML = '';
        db.produk.forEach(p => dl.innerHTML += `<option value="${p.nama}">Stok: ${p.stok} | Rp ${p.harga}</option>`);
    }

    function updateHarga() {
        let val = document.getElementById('inputBarang').value;
        let p = db.produk.find(x => x.nama === val);
        if(p) { document.getElementById('hargaBarang').value = p.harga; document.getElementById('qtyBarang').focus(); }
    }

    function tambahItem() {
        let val = document.getElementById('inputBarang').value;
        let qty = Number(document.getElementById('qtyBarang').value);
        let p = db.produk.find(x => x.nama === val);
        
        if(!p) return alert("Barang tidak ditemukan!");
        if(p.stok < qty) return alert("Stok kurang!");

        keranjang.push({ id: p.id, nama: p.nama, harga: p.harga, qty: qty, total: p.harga * qty });
        renderNotaIsi();
        document.getElementById('inputBarang').value = ""; document.getElementById('hargaBarang').value = ""; document.getElementById('qtyBarang').value = "1"; document.getElementById('inputBarang').focus();
    }

    function renderNotaIsi() {
        let tbody = document.getElementById('notaIsi'); tbody.innerHTML = '';
        let total = 0;
        keranjang.forEach((item, idx) => {
            total += item.total;
            tbody.innerHTML += `
                <tr>
                    <td class="text-center">${idx + 1}</td>
                    <td contenteditable="true" class="editable-name" id="item_name_${idx}">${item.nama}</td>
                    <td class="text-center">${item.qty}</td>
                    <td class="text-end">${item.harga.toLocaleString()}</td>
                    <td class="text-end fw-bold">${item.total.toLocaleString()}</td>
                    <td class="no-print"><a href="#" onclick="keranjang.splice(${idx},1); renderNotaIsi()" class="text-danger">x</a></td>
                </tr>`;
        });
        document.getElementById('notaTotal').innerText = total.toLocaleString();
        document.getElementById('notaTotal').dataset.val = total;
        document.getElementById('notaYth').innerText = document.getElementById('custNama').value || "..................";
        document.getElementById('notaHp').innerText = document.getElementById('custTelp').value || "";
        hitungSisa();
    }

    function hitungSisa() {
        let total = Number(document.getElementById('notaTotal').dataset.val || 0);
        let dp = Number(document.getElementById('inputDP').value || 0);
        let sisa = dp - total;
        document.getElementById('notaSisa').innerText = sisa >= 0 ? "KEMBALI: " + sisa.toLocaleString() : "KURANG: " + Math.abs(sisa).toLocaleString();
        document.getElementById('printDP').innerText = dp.toLocaleString();
    }

    function simpanDanCetak() {
        if(keranjang.length === 0) return alert("Keranjang kosong!");
        
        keranjang.forEach((item, idx) => {
            let el = document.getElementById(`item_name_${idx}`);
            if(el) item.nama = el.innerText;
            let p = db.produk.find(x => x.id == item.id);
            if(p) p.stok -= item.qty;
        });

        db.nota.push({
            no: document.getElementById('notaNo').innerText,
            tgl: new Date().toISOString(),
            nama: document.getElementById('custNama').value,
            items: [...keranjang],
            total: Number(document.getElementById('notaTotal').dataset.val),
            dp: Number(document.getElementById('inputDP').value),
            sisaInfo: document.getElementById('notaSisa').innerText
        });
        simpanKeBrowser();

        document.body.classList.add('print-nota');
        window.print();
        document.body.classList.remove('print-nota');

        keranjang = []; document.getElementById('custNama').value = ''; document.getElementById('inputDP').value = ''; renderNotaIsi(); initView();
    }

    function renderRiwayatNota() {
        let key = document.getElementById('cariNota').value.toLowerCase();
        let tbody = document.getElementById('tabelRiwayatNota'); tbody.innerHTML = '';
        db.nota.slice().reverse().forEach(n => {
            if(n.nama?.toLowerCase().includes(key) || n.no.toLowerCase().includes(key)) {
                tbody.innerHTML += `<tr><td>${n.no}</td><td>${n.nama}</td><td><button onclick="cetakUlang('${n.no}')" class="btn btn-sm btn-outline-primary py-0">Print</button></td></tr>`;
            }
        });
    }

    function cetakUlang(no) {
        let n = db.nota.find(x => x.no === no);
        if(!n) return;
        document.getElementById('notaNo').innerText = n.no;
        document.getElementById('notaYth').innerText = n.nama;
        let tbody = document.getElementById('notaIsi'); tbody.innerHTML = '';
        n.items.forEach((item, idx) => {
            tbody.innerHTML += `<tr><td class="text-center">${idx+1}</td><td>${item.nama}</td><td class="text-center">${item.qty}</td><td class="text-end">${item.harga.toLocaleString()}</td><td class="text-end fw-bold">${item.total.toLocaleString()}</td><td></td></tr>`;
        });
        document.getElementById('notaTotal').innerText = n.total.toLocaleString();
        document.getElementById('printDP').innerText = n.dp.toLocaleString();
        document.getElementById('notaSisa').innerText = n.sisaInfo;
        
        document.body.classList.add('print-nota'); window.print(); document.body.classList.remove('print-nota');
        initView();
    }

    function tambahProduk() {
        let nama = document.getElementById('prodNama').value;
        if(nama) { db.produk.push({ id: Date.now(), nama, harga: Number(document.getElementById('prodHarga').value), stok: Number(document.getElementById('prodStok').value), min: Number(document.getElementById('prodMin').value) }); simpanKeBrowser(); initView(); }
    }
    function renderGudang() {
        let key = document.getElementById('cariGudang').value.toLowerCase();
        let tbody = document.getElementById('tabelGudang'); tbody.innerHTML = '';
        db.produk.forEach((p, idx) => {
            if(p.nama.toLowerCase().includes(key)) tbody.innerHTML += `<tr><td>${p.nama}</td><td class="${p.stok<=p.min?'text-danger fw-bold':''}">${p.stok}</td><td><button onclick="db.produk[${idx}].stok+=parseInt(prompt('Tambah:')||0);simpanKeBrowser();renderGudang()" class="btn btn-success btn-sm py-0">+</button></td><td><button onclick="db.produk.splice(${idx},1);simpanKeBrowser();initView()" class="btn btn-danger btn-sm py-0">x</button></td></tr>`;
        });
    }
    function cetakBelanja() {
        let tbody = document.getElementById('isiBelanja'); tbody.innerHTML = ''; let no=1;
        db.produk.forEach(p => { if(p.stok<=p.min) tbody.innerHTML += `<tr><td>${no++}</td><td>${p.nama}</td><td>${p.stok}</td><td>[ ]</td></tr>`; });
        if(no>1) { document.body.classList.add('print-belanja'); window.print(); document.body.classList.remove('print-belanja'); } else alert("Stok Aman");
    }

    function simpanPengeluaran() {
        let tgl=document.getElementById('expTgl').value; let ket=document.getElementById('expKet').value; let jml=Number(document.getElementById('expJml').value);
        if(tgl&&ket&&jml) { db.pengeluaran.push({tglStr:tgl, ket, jml}); simpanKeBrowser(); renderLaporan(); document.getElementById('expKet').value=''; document.getElementById('expJml').value=''; }
    }
    function simpanPemasukanLain() {
        let tgl=document.getElementById('inTgl').value; let ket=document.getElementById('inKet').value; let jml=Number(document.getElementById('inJml').value);
        if(tgl&&ket&&jml) { db.pemasukanLain.push({tglStr:tgl, ket, jml}); simpanKeBrowser(); renderLaporan(); document.getElementById('inKet').value=''; document.getElementById('inJml').value=''; }
    }
    function renderLaporan() {
        let tbody = document.getElementById('tabelLaporan'); tbody.innerHTML = ''; let allData = [];
        db.nota.forEach(n => allData.push({d: new Date(n.tgl), tgl: new Date(n.tgl).toLocaleString('id-ID'), ket: `Nota: ${n.no}`, in: n.total, out: 0, type:'in'}));
        db.pengeluaran.forEach(e => allData.push({d: new Date(e.tglStr), tgl: new Date(e.tglStr).toLocaleDateString('id-ID'), ket: `Biaya: ${e.ket}`, in: 0, out: e.jml, type:'out'}));
        db.pemasukanLain.forEach(i => allData.push({d: new Date(i.tglStr), tgl: new Date(i.tglStr).toLocaleDateString('id-ID'), ket: `Modal: ${i.ket}`, in: i.jml, out: 0, type:'modal'}));
        allData.sort((a,b)=>b.d-a.d);
        let totM=0, totK=0;
        allData.forEach(d=>{
            totM+=d.in; totK+=d.out;
            let cls = d.type=='in'?'table-masuk':(d.type=='modal'?'table-modal':'table-keluar');
            tbody.innerHTML += `<tr class="${cls}"><td>${d.tgl}</td><td>${d.ket}</td><td class="text-end">${d.in>0?d.in.toLocaleString():'-'}</td><td class="text-end">${d.out>0?d.out.toLocaleString():'-'}</td></tr>`;
        });
        document.getElementById('totMasuk').innerText = totM.toLocaleString(); document.getElementById('totKeluar').innerText = totK.toLocaleString(); document.getElementById('totProfit').innerText = (totM-totK).toLocaleString();
    }
    function resetData(){ if(confirm("Reset Data?")) { localStorage.clear(); location.reload(); }}
    function downloadDB(){ let a=document.createElement('a'); a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(db)); a.download="BACKUP_MUSADAD_V9.json"; document.body.appendChild(a); a.click(); a.remove(); }
    function uploadDB(i){ let r=new FileReader(); r.onload=e=>{ try{ let d=JSON.parse(e.target.result); if(d.produk){ db=d; simpanKeBrowser(); location.reload(); } }catch(x){alert("Error");} }; r.readAsText(i.files[0]); }
</script>
</body>
</html>
