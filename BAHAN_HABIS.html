<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Cetak Abis Bahan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">📋 Aplikasi Cetak Abis Bahan</h1>
            <p class="text-gray-600 text-center">Kelola data cetak dan perhitungan bahan habis</p>
        </div>

        <!-- Form Input -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Input Data Cetak</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">No</label>
                    <input type="number" id="inputNo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Masukkan nomor">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                    <input type="date" id="inputTanggal" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cetak</label>
                    <input type="number" id="inputCetak" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Jumlah cetak">
                </div>
                <div class="flex items-end gap-2 flex-wrap">
                    <button onclick="saveData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        💾 Save
                    </button>
                    <button onclick="deleteData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        🗑️ Hapus
                    </button>
                    <button onclick="addNew()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        ➕ Add
                    </button>
                    <button onclick="uploadData()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        ☁️ Upload
                    </button>
                    <button onclick="downloadData()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        📥 Ambil Data
                    </button>
                </div>
            </div>
        </div>

        <!-- Database Display -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">📊 Database Cetak</h2>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">NO</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">TANGGAL</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">CETAK</th>
                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">JUMLAH BAHAN</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable">
                        <!-- Data akan ditampilkan di sini -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Bahan Habis -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">⚠️ Bahan Habis</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Bahan Awal:</label>
                <select id="bahanAwal" onchange="updateBahanHabis()" class="w-48 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="70">70</option>
                    <option value="80">80</option>
                </select>
            </div>
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                    <span class="text-lg font-medium text-red-800">Total Bahan Habis:</span>
                    <span id="bahanHabis" class="text-2xl font-bold text-red-600">0</span>
                </div>
                <p class="text-sm text-red-600 mt-2">Perhitungan: <span id="bahanAwalText">70</span> - Jumlah Bahan Data Terakhir</p>
            </div>
        </div>
    </div>

    <script>
        let dataList = [];
        let selectedIndex = -1;

        // Set tanggal hari ini sebagai default
        document.getElementById('inputTanggal').value = new Date().toISOString().split('T')[0];

        function saveData() {
            const no = document.getElementById('inputNo').value;
            const tanggal = document.getElementById('inputTanggal').value;
            const cetak = document.getElementById('inputCetak').value;

            if (!no || !tanggal || !cetak) {
                alert('Mohon lengkapi semua field!');
                return;
            }

            const newData = {
                no: parseInt(no),
                tanggal: tanggal,
                cetak: parseInt(cetak),
                jumlahBahan: 0 // Akan dihitung ulang setelah data disimpan
            };

            if (selectedIndex >= 0) {
                // Update data yang sudah ada
                dataList[selectedIndex] = newData;
                selectedIndex = -1;
            } else {
                // Tambah data baru
                dataList.push(newData);
            }

            // Hitung ulang semua jumlah bahan
            recalculateJumlahBahan();
            updateTable();
            updateBahanHabis();
            clearForm();
            // Set nomor berikutnya setelah save
            if (selectedIndex < 0) { // Hanya jika menambah data baru
                setNextNumber();
            }
            // Auto-save setelah perubahan
            autoSave();
        }

        function recalculateJumlahBahan() {
            let totalCetak = 0;
            dataList.forEach((data, index) => {
                totalCetak += data.cetak;
                data.jumlahBahan = totalCetak;
            });
        }

        function deleteData() {
            if (selectedIndex >= 0) {
                dataList.splice(selectedIndex, 1);
                selectedIndex = -1;
                // Hitung ulang semua jumlah bahan setelah hapus data
                recalculateJumlahBahan();
                updateTable();
                updateBahanHabis();
                clearForm();
                // Auto-save setelah perubahan
                autoSave();
            } else {
                alert('Pilih data yang ingin dihapus terlebih dahulu!');
            }
        }

        function addNew() {
            clearForm();
            selectedIndex = -1;
            // Set nomor otomatis ke nomor terakhir + 1
            setNextNumber();
        }

        function clearForm() {
            document.getElementById('inputNo').value = '';
            document.getElementById('inputTanggal').value = new Date().toISOString().split('T')[0];
            document.getElementById('inputCetak').value = '';
        }

        function setNextNumber() {
            // Cari nomor terakhir dari data yang ada
            let lastNumber = 0;
            if (dataList.length > 0) {
                lastNumber = Math.max(...dataList.map(data => data.no));
            }
            document.getElementById('inputNo').value = lastNumber + 1;
        }

        function selectRow(index) {
            selectedIndex = index;
            const data = dataList[index];
            
            document.getElementById('inputNo').value = data.no;
            document.getElementById('inputTanggal').value = data.tanggal;
            document.getElementById('inputCetak').value = data.cetak;

            // Highlight selected row
            updateTable();
        }

        function updateTable() {
            const tableBody = document.getElementById('dataTable');
            tableBody.innerHTML = '';

            dataList.forEach((data, index) => {
                const row = document.createElement('tr');
                row.className = selectedIndex === index ? 'bg-blue-100 cursor-pointer hover:bg-blue-200' : 'cursor-pointer hover:bg-gray-50';
                row.onclick = () => selectRow(index);
                
                row.innerHTML = `
                    <td class="border border-gray-300 px-4 py-3">${data.no}</td>
                    <td class="border border-gray-300 px-4 py-3">${formatDate(data.tanggal)}</td>
                    <td class="border border-gray-300 px-4 py-3">${data.cetak}</td>
                    <td class="border border-gray-300 px-4 py-3 font-semibold text-blue-600">${data.jumlahBahan}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function updateBahanHabis() {
            // Ambil nilai bahan awal dari combobox
            const bahanAwal = parseInt(document.getElementById('bahanAwal').value);
            // Ambil jumlah bahan dari data terakhir
            const jumlahBahanTerakhir = dataList.length > 0 ? dataList[dataList.length - 1].jumlahBahan : 0;
            const bahanHabis = Math.max(0, bahanAwal - jumlahBahanTerakhir);
            
            document.getElementById('bahanHabis').textContent = bahanHabis;
            document.getElementById('bahanAwalText').textContent = bahanAwal;
            
            // Auto-save saat bahan awal berubah
            autoSave();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function uploadData() {
            if (dataList.length === 0) {
                alert('Tidak ada data untuk diupload!');
                return;
            }

            // Buat data untuk disimpan
            const uploadData = {
                timestamp: new Date().toISOString(),
                bahanAwal: parseInt(document.getElementById('bahanAwal').value),
                data: dataList
            };

            try {
                // Simpan ke Local Storage (penyimpanan browser)
                localStorage.setItem('cetakAppData', JSON.stringify(uploadData));
                
                // Juga buat file download sebagai backup
                const jsonData = JSON.stringify(uploadData, null, 2);
                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cetak_data_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('✅ Data berhasil disimpan!\n\n📱 Tersimpan otomatis di browser\n💾 File JSON juga didownload sebagai backup\n\nCatatan: Data akan otomatis dimuat saat buka aplikasi lagi di browser yang sama.');
            } catch (error) {
                alert('❌ Gagal menyimpan data: ' + error.message);
            }
        }

        function downloadData() {
            // Cek apakah ada data tersimpan di Local Storage
            const savedData = localStorage.getItem('cetakAppData');
            
            if (savedData) {
                if (confirm('🔍 Ditemukan data tersimpan di browser!\n\nPilih:\n✅ OK = Muat data dari browser\n❌ Cancel = Pilih file JSON dari komputer')) {
                    try {
                        const importedData = JSON.parse(savedData);
                        loadImportedData(importedData);
                        return;
                    } catch (error) {
                        alert('❌ Error membaca data tersimpan: ' + error.message);
                    }
                }
            }

            // Buat input file untuk memilih file JSON
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        loadImportedData(importedData);
                    } catch (error) {
                        alert('❌ Error membaca file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function loadImportedData(importedData) {
            if (importedData.data && Array.isArray(importedData.data)) {
                // Konfirmasi sebelum mengganti data
                if (confirm('⚠️ Apakah Anda yakin ingin mengganti semua data dengan data yang diimport?')) {
                    dataList = importedData.data;
                    
                    // Set bahan awal jika ada
                    if (importedData.bahanAwal) {
                        document.getElementById('bahanAwal').value = importedData.bahanAwal;
                    }
                    
                    // Update tampilan
                    recalculateJumlahBahan();
                    updateTable();
                    updateBahanHabis();
                    clearForm();
                    
                    alert(`✅ Data berhasil dimuat!\n📊 Jumlah data: ${dataList.length}\n📅 Tanggal backup: ${importedData.timestamp ? new Date(importedData.timestamp).toLocaleString('id-ID') : 'Tidak diketahui'}`);
                }
            } else {
                alert('❌ Format file tidak valid! Pastikan file JSON memiliki struktur yang benar.');
            }
        }

        // Auto-save setiap kali ada perubahan data
        function autoSave() {
            if (dataList.length > 0) {
                const autoSaveData = {
                    timestamp: new Date().toISOString(),
                    bahanAwal: parseInt(document.getElementById('bahanAwal').value),
                    data: dataList
                };
                try {
                    localStorage.setItem('cetakAppData', JSON.stringify(autoSaveData));
                } catch (error) {
                    console.log('Auto-save failed:', error);
                }
            }
        }

        // Load data otomatis saat halaman dimuat
        function loadAutoSavedData() {
            const savedData = localStorage.getItem('cetakAppData');
            if (savedData) {
                try {
                    const importedData = JSON.parse(savedData);
                    if (importedData.data && Array.isArray(importedData.data) && importedData.data.length > 0) {
                        dataList = importedData.data;
                        
                        if (importedData.bahanAwal) {
                            document.getElementById('bahanAwal').value = importedData.bahanAwal;
                        }
                        
                        recalculateJumlahBahan();
                        updateTable();
                        updateBahanHabis();
                        
                        // Tampilkan notifikasi bahwa data dimuat otomatis
                        setTimeout(() => {
                            alert(`📱 Data otomatis dimuat dari penyimpanan browser!\n📊 Jumlah data: ${dataList.length}\n📅 Terakhir disimpan: ${new Date(importedData.timestamp).toLocaleString('id-ID')}`);
                        }, 500);
                    }
                } catch (error) {
                    console.log('Failed to load auto-saved data:', error);
                }
            }
        }

        // Inisialisasi dengan data contoh
        dataList = [
            { no: 1, tanggal: '2024-01-15', cetak: 2, jumlahBahan: 2 },   // Cetak 2 = Jumlah Bahan 2
            { no: 2, tanggal: '2024-01-16', cetak: 4, jumlahBahan: 6 },   // Cetak 4 + 2 = Jumlah Bahan 6
            { no: 3, tanggal: '2024-01-17', cetak: 3, jumlahBahan: 9 }    // Cetak 3 + 6 = Jumlah Bahan 9
        ];

        // Load data otomatis saat halaman dimuat
        loadAutoSavedData();
        
        updateTable();
        updateBahanHabis();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976d16fd570da8e5',t:'MTc1NjQ4MTQyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
