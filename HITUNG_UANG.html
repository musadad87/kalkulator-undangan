<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Itung Uang (Lokal)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 p-8 flex items-start justify-center min-h-screen">
    <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-7xl relative">
        <div class="bg-green-600 text-white rounded-t-lg p-4 flex items-center justify-between -m-8 mb-4">
            <h1 class="text-xl font-bold">Form Itung Uang</h1>
            <button onclick="showInfoModal()" class="text-white hover:text-gray-200 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.15-1.285 3.51-1.285 4.64 0L19.344 11l-3.213 4.293a3.51 3.51 0 01-4.64 0L4.656 11l3.213-4.293a3.51 3.51 0 012.01 0z" />
                </svg>
            </button>
        </div>
        
        <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Input Data Section -->
            <div class="bg-gray-50 rounded-lg p-6 shadow-md col-span-1">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2 text-green-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Input Data
                </h2>
                <div class="mb-4">
                    <label for="id-display" class="block text-sm font-medium text-gray-700">ID (Lokal)</label>
                    <input type="text" id="id-display" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-200 cursor-not-allowed" readonly>
                </div>
                <div class="mb-4">
                    <label for="tanggal-input" class="block text-sm font-medium text-gray-700">Tanggal</label>
                    <div class="relative mt-1">
                        <input type="date" id="tanggal-input" class="block w-full rounded-md border-gray-300 shadow-sm p-2 pr-10">
                    </div>
                </div>

                <!-- Hitung Uang Section -->
                <div class="rounded-lg mt-6">
                    <h3 class="text-md font-semibold text-gray-800 flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 mr-2 text-green-600">
                            <path fill-rule="evenodd" d="M12 1.5a5.25 5.25 0 00-5.25 5.25v3a3 3 0 00-3 3v6.75a3 3 0 003 3h10.5a3 3 0 003-3v-6.75a3 3 0 00-3-3v-3c0-2.9-2.35-5.25-5.25-5.25zM3.75 4.5a.75.75 0 000 1.5.75.75 0 000-1.5z" clip-rule="evenodd" />
                        </svg>
                        Hitung Uang
                    </h3>
                    <div id="input-denominations" class="space-y-3">
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 100.000</span>
                            <input type="number" data-denomination="100000" name="jumlah_lembar" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah lembar</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 75.000</span>
                            <input type="number" data-denomination="75000" name="jumlah_lembar" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah lembar</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 50.000</span>
                            <input type="number" data-denomination="50000" name="jumlah_lembar" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah lembar</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 20.000</span>
                            <input type="number" data-denomination="20000" name="jumlah_lembar" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah lembar</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 10.000</span>
                            <input type="number" data-denomination="10000" name="jumlah_lembar" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah lembar</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 5.000</span>
                            <input type="number" data-denomination="5000" name="jumlah_lembar" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah lembar</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 2.000</span>
                            <input type="number" data-denomination="2000" name="jumlah_lembar" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah lembar</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 1.000</span>
                            <input type="number" data-denomination="1000" name="jumlah_lembar" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah lembar</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 500</span>
                            <input type="number" data-denomination="500" name="jumlah_koin" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah koin</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="w-24">Rp. 200</span>
                            <input type="number" data-denomination="200" name="jumlah_koin" value="0" min="0" class="w-20 rounded-md border border-gray-300 p-1 text-center">
                            <span>× Jumlah koin</span>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-green-50 rounded-lg text-center">
                        <p class="text-sm text-green-700">Total Uang:</p>
                        <p id="total-uang" class="text-xl font-bold text-green-800">Rp 0</p>
                    </div>
                    <button id="hitung-total-btn" class="mt-4 w-full bg-green-600 text-white rounded-lg py-2 font-bold hover:bg-green-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 inline-block mr-2">
                            <path fill-rule="evenodd" d="M12 1.5a5.25 5.25 0 00-5.25 5.25v3a3 3 0 00-3 3v6.75a3 3 0 003 3h10.5a3 3 0 003-3v-6.75a3 3 0 00-3-3v-3c0-2.9-2.35-5.25-5.25-5.25zM3.75 4.5a.75.75 0 000 1.5.75.75 0 000-1.5z" clip-rule="evenodd" />
                        </svg>
                        Hitung Total
                    </button>
                </div>
            </div>

            <!-- Data Table Section -->
            <div class="bg-gray-50 rounded-lg p-6 shadow-md col-span-1 lg:col-span-2">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2 text-green-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v1.5a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 12A2.25 2.25 0 016 9.75h2.25a2.25 2.25 0 012.25 2.25v1.5a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V12zM3.75 18A2.25 2.25 0 016 15.75h2.25a2.25 2.25 0 012.25 2.25v1.5a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V18zM12 6a2.25 2.25 0 012.25-2.25h2.25A2.25 2.25 0 0119.5 6v1.5a2.25 2.25 0 01-2.25 2.25H14.25a2.25 2.25 0 01-2.25-2.25V6zM12 12a2.25 2.25 0 012.25-2.25h2.25a2.25 2.25 0 012.25 2.25v1.5a2.25 2.25 0 01-2.25 2.25H14.25a2.25 2.25 0 01-2.25-2.25V12zM12 18a2.25 2.25 0 012.25-2.25h2.25a2.25 2.25 0 012.25 2.25v1.5a2.25 2.25 0 01-2.25 2.25H14.25a2.25 2.25 0 01-2.25-2.25V18z" />
                    </svg>
                    Data Itung Uang
                </h2>
                <p id="data-info" class="text-sm text-gray-500 mb-4">Memuat data...</p>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="py-2 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ID</th>
                                <th class="py-2 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Tanggal</th>
                                <th class="py-2 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Keuangan</th>
                                <th class="py-2 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Data rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Kontrol Section -->
            <div class="bg-gray-50 rounded-lg p-6 shadow-md col-span-1">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 mr-2 text-green-600">
                        <path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z" />
                        <path d="M12.75 12.75a.75.75 0 01-.75.75H7.5a.75.75 0 010-1.5h2.25c.414 0 .75-.336.75-.75V7.5a.75.75 0 011.5 0v2.25c0 .414.336.75.75.75h2.25a.75.75 0 010 1.5H12.75z" />
                    </svg>
                    Kontrol
                </h2>
                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">Navigasi Data:</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="pertama-btn" class="bg-blue-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-blue-600 transition-colors disabled:opacity-50">Pertama</button>
                        <button id="sebelum-btn" class="bg-blue-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-blue-600 transition-colors disabled:opacity-50">Sebelum</button>
                        <button id="sesudah-btn" class="bg-blue-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-blue-600 transition-colors disabled:opacity-50">Sesudah</button>
                        <button id="terakhir-btn" class="bg-blue-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-blue-600 transition-colors disabled:opacity-50">Terakhir</button>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">Aksi Data:</h3>
                    <div class="grid grid-cols-1 gap-2">
                        <button id="simpan-data-btn" class="bg-green-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-green-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 inline-block mr-2">
                                <path fill-rule="evenodd" d="M16.5 6a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V7.5h-1.5a.75.75 0 010-1.5h2.25zM12 1.5a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V2.25a.75.75 0 01.75-.75z" clip-rule="evenodd" />
                                <path d="M6 13.5a.75.75 0 01-.75-.75v-3a.75.75 0 011.5 0v3a.75.75 0 01-.75.75zM12 13.5a.75.75 0 01-.75-.75v-3a.75.75 0 011.5 0v3a.75.75 0 01-.75.75zM18 13.5a.75.75 0 01-.75-.75v-3a.75.75 0 011.5 0v3a.75.75 0 01-.75.75zM10.5 7.5a.75.75 0 01.75.75V11a.75.75 0 01-1.5 0V8.25a.75.75 0 01.75-.75zM3.75 12a.75.75 0 01.75.75V15a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM15 12a.75.75 0 01.75.75V15a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM18 12a.75.75 0 01.75.75V15a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM12 15a.75.75 0 01.75.75V18a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM6 16.5a.75.75 0 01.75.75V18a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75.75zM21 16.5a.75.75 0 01.75.75V18a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75.75z" />
                                <path fill-rule="evenodd" d="M12 21a.75.75 0 01.75.75V22.5a.75.75 0 01-1.5 0V21.75a.75.75 0 01.75-.75z" clip-rule="evenodd" />
                            </svg>
                            Simpan Data
                        </button>
                        <button id="batal-ubah-btn" class="bg-yellow-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-yellow-600 transition-colors hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 inline-block mr-2">
                                <path d="M12 21a9 9 0 100-18 9 9 0 000 18zM10.25 7.5a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5z" />
                                <path d="M13.25 7.5a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5zM16.25 7.5a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5z" />
                            </svg>
                            Batal Ubah
                        </button>
                        <button id="refresh-btn" class="bg-orange-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-orange-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 inline-block mr-2">
                                <path fill-rule="evenodd" d="M12 21a9 9 0 009-9v-1.5a.75.75 0 00-1.5 0V12a7.5 7.5 0 01-7.5 7.5h-1.5a.75.75 0 000 1.5h1.5zm-9-9v1.5a.75.75 0 001.5 0V12a7.5 7.5 0 017.5-7.5h1.5a.75.75 0 000-1.5h-1.5A9 9 0 003 12z" clip-rule="evenodd" />
                            </svg>
                            Refresh
                        </button>
                        <button id="data-baru-btn" class="bg-indigo-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-indigo-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 inline-block mr-2">
                                <path d="M12 21a9 9 0 100-18 9 9 0 000 18z" />
                                <path d="M10.25 7.5a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5z" />
                                <path d="M13.25 7.5a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5z" />
                                <path d="M16.25 7.5a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5z" />
                            </svg>
                            Data Baru
                        </button>
                        <button id="hapus-data-btn" class="bg-red-500 text-white rounded-md py-2 text-sm font-semibold hover:bg-red-600 transition-colors" onclick="deleteData(document.getElementById('id-display').textContent)">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 inline-block mr-2">
                                <path fill-rule="evenodd" d="M16.5 4.5V1.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V4.5H8.25a.75.75 0 000 1.5H11.5v-1.5h1.5v1.5h2.25a.75.75 0 000-1.5H16.5zM7.5 12a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75v3a.75.75 0 001.5 0v-2.25a.75.75 0 00-.75-.75H7.5zM12 12a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75v3a.75.75 0 001.5 0v-2.25a.75.75 0 00-.75-.75H12zM16.5 12a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75v3a.75.75 0 001.5 0v-2.25a.75.75 0 00-.75-.75H16.5z" clip-rule="evenodd" />
                            </svg>
                            Hapus Data
                        </button>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">Detail Perhitungan:</h3>
                    <p id="detail-perhitungan-text" class="text-sm text-gray-500">Belum ada perhitungan</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal -->
    <div id="custom-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
            <p id="modal-message" class="text-lg font-semibold text-gray-800 text-center mb-4"></p>
            <div class="flex justify-center space-x-4">
                <button id="modal-confirm" class="bg-green-500 text-white rounded-md py-2 px-6 text-sm font-semibold hover:bg-green-600 transition-colors">OK</button>
                <button id="modal-cancel" class="bg-gray-300 text-gray-800 rounded-md py-2 px-6 text-sm font-semibold hover:bg-gray-400 transition-colors">Batal</button>
            </div>
        </div>
    </div>

    <script>
        let data = [];
        let currentIndex = 0;
        let isEditing = false;
        let currentEditingId = null;

        // Function to generate a unique ID
        function generateId() {
            return 'id-' + Date.now() + '-' + Math.random().toString(16).substr(2, 9);
        }

        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
        }

        function calculateTotal() {
            let total = 0;
            const inputContainer = document.getElementById('input-denominations');
            inputContainer.querySelectorAll('input[type="number"]').forEach(input => {
                const value = parseInt(input.value) || 0;
                const denomination = parseInt(input.dataset.denomination);
                total += value * denomination;
            });
            return total;
        }

        function displayTotal() {
            const total = calculateTotal();
            document.getElementById('total-uang').textContent = formatRupiah(total);
        }

        document.getElementById('hitung-total-btn').addEventListener('click', displayTotal);

        document.querySelectorAll('input[name="jumlah_lembar"], input[name="jumlah_koin"]').forEach(input => {
            input.addEventListener('input', displayTotal);
        });

        function loadData() {
            try {
                const storedData = localStorage.getItem('moneyCounterData');
                if (storedData) {
                    data = JSON.parse(storedData);
                } else {
                    data = [];
                }
                data.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
                renderTable();
                updateNavigationButtons();
            } catch (error) {
                console.error("Error loading data from localStorage:", error);
                data = [];
            }
        }

        function saveData() {
            try {
                localStorage.setItem('moneyCounterData', JSON.stringify(data));
            } catch (error) {
                console.error("Error saving data to localStorage:", error);
                showModal('Gagal menyimpan data ke penyimpanan lokal.');
            }
        }

        function renderTable() {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="py-4 text-center text-gray-500">Tidak ada data.</td></tr>';
                document.getElementById('data-info').textContent = `Menampilkan 0 dari 0 data`;
                return;
            }

            data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50 transition-colors';
                row.innerHTML = `
                    <td class="py-2 px-4 text-sm font-medium text-gray-900">${index + 1}</td>
                    <td class="py-2 px-4 text-sm text-gray-500">${item.tanggal}</td>
                    <td class="py-2 px-4 text-sm text-gray-500">
                        Total Uang:<br>
                        <span class="font-semibold text-green-600">${formatRupiah(item.totalUang)}</span>
                    </td>
                    <td class="py-2 px-4 text-sm text-gray-500">
                        <div class="flex space-x-2">
                            <button onclick="editData('${item.id}')" class="bg-blue-500 text-white px-3 py-1 rounded-full text-xs hover:bg-blue-600 transition-colors">Pilih</button>
                            <button onclick="deleteData('${item.id}')" class="bg-red-500 text-white px-3 py-1 rounded-full text-xs hover:bg-red-600 transition-colors">Hapus</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            updateDataInfo();
        }

        function updateDataInfo() {
            document.getElementById('data-info').textContent = `Menampilkan ${data.length} dari ${data.length} data`;
        }
        
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('sebelum-btn');
            const nextBtn = document.getElementById('sesudah-btn');
            const firstBtn = document.getElementById('pertama-btn');
            const lastBtn = document.getElementById('terakhir-btn');
            
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === data.length - 1;
            firstBtn.disabled = currentIndex === 0;
            lastBtn.disabled = currentIndex === data.length - 1;
        }

        function showData(index) {
            if (index < 0 || index >= data.length) return;
            currentIndex = index;
            const item = data[currentIndex];
            document.getElementById('tanggal-input').value = item.tanggal;
            document.getElementById('total-uang').textContent = formatRupiah(item.totalUang);
            document.getElementById('id-display').value = item.id;
            
            const inputs = document.getElementById('input-denominations').querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                const denomination = parseInt(input.dataset.denomination);
                input.value = item.denominations[denomination] || 0;
            });
            updateNavigationButtons();
            
            const detailText = Object.entries(item.denominations)
                .filter(([key, value]) => value > 0)
                .map(([key, value]) => `${formatRupiah(parseInt(key))} x ${value} = ${formatRupiah(parseInt(key) * value)}`)
                .join('<br>');
            document.getElementById('detail-perhitungan-text').innerHTML = detailText || 'Belum ada perhitungan';
        }

        document.getElementById('pertama-btn').addEventListener('click', () => showData(0));
        document.getElementById('sebelum-btn').addEventListener('click', () => showData(currentIndex - 1));
        document.getElementById('sesudah-btn').addEventListener('click', () => showData(currentIndex + 1));
        document.getElementById('terakhir-btn').addEventListener('click', () => showData(data.length - 1));

        document.getElementById('simpan-data-btn').addEventListener('click', () => {
            const tanggal = document.getElementById('tanggal-input').value;
            if (!tanggal) {
                showModal('Tanggal tidak boleh kosong.');
                return;
            }

            const totalUang = calculateTotal();
            const denominations = {};
            document.querySelectorAll('input[type="number"]').forEach(input => {
                denominations[input.dataset.denomination] = parseInt(input.value) || 0;
            });

            if (isEditing) {
                const indexToUpdate = data.findIndex(item => item.id === currentEditingId);
                if (indexToUpdate !== -1) {
                    data[indexToUpdate] = { ...data[indexToUpdate], tanggal, totalUang, denominations };
                    showModal('Data berhasil diperbarui!');
                }
            } else {
                const newData = {
                    id: generateId(),
                    tanggal,
                    totalUang,
                    denominations,
                    timestamp: new Date().toISOString()
                };
                data.push(newData);
                showModal('Data berhasil disimpan!');
            }
            saveData();
            loadData();
            resetForm();
        });

        document.getElementById('batal-ubah-btn').addEventListener('click', () => resetForm());
        document.getElementById('refresh-btn').addEventListener('click', () => loadData());
        document.getElementById('data-baru-btn').addEventListener('click', () => resetForm());

        window.editData = (id) => {
            const item = data.find(d => d.id === id);
            if (item) {
                document.getElementById('tanggal-input').value = item.tanggal;
                document.getElementById('total-uang').textContent = formatRupiah(item.totalUang);
                document.getElementById('id-display').value = item.id;
                
                const inputs = document.getElementById('input-denominations').querySelectorAll('input[type="number"]');
                inputs.forEach(input => {
                    const denomination = parseInt(input.dataset.denomination);
                    input.value = item.denominations[denomination] || 0;
                });
                
                isEditing = true;
                currentEditingId = id;
                document.getElementById('simpan-data-btn').textContent = "Ubah Data";
                document.getElementById('batal-ubah-btn').classList.remove('hidden');
            } else {
                showModal("Data tidak ditemukan.");
            }
        };

        window.deleteData = (id) => {
            showConfirmModal("Apakah Anda yakin ingin menghapus data ini?").then(result => {
                if (result) {
                    data = data.filter(item => item.id !== id);
                    saveData();
                    loadData();
                    showModal("Data berhasil dihapus!");
                    resetForm();
                }
            });
        };
        
        function resetForm() {
            document.getElementById('tanggal-input').value = new Date().toISOString().slice(0, 10);
            document.getElementById('total-uang').textContent = 'Rp 0';
            document.getElementById('id-display').value = '';

            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.value = 0;
            });
            displayTotal();
            document.getElementById('detail-perhitungan-text').textContent = 'Belum ada perhitungan';

            isEditing = false;
            currentEditingId = null;
            document.getElementById('simpan-data-btn').textContent = "Simpan Data";
            document.getElementById('batal-ubah-btn').classList.add('hidden');
        }

        // --- Custom Modal Functions ---
        const modal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirm = document.getElementById('modal-confirm');
        const modalCancel = document.getElementById('modal-cancel');

        function showModal(message, isConfirm = false) {
            modalMessage.textContent = message;
            modalConfirm.style.display = isConfirm ? 'inline-block' : 'none';
            modalCancel.style.display = isConfirm ? 'inline-block' : 'none';
            modal.classList.remove('hidden');
            return new Promise(resolve => {
                modalConfirm.onclick = () => { modal.classList.add('hidden'); resolve(true); };
                modalCancel.onclick = () => { modal.classList.add('hidden'); resolve(false); };
                if (!isConfirm) {
                    setTimeout(() => { modal.classList.add('hidden'); resolve(true); }, 2000);
                }
            });
        }
        
        function showConfirmModal(message) {
            return showModal(message, true);
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            resetForm();
            loadData();
        });
    </script>
</body>
</html>
